<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#ff758c">
<title>Catch the Love - For Beatrix ‚ù§Ô∏è</title>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

body {
    margin: 0;
    overflow: hidden;
    background: linear-gradient(to bottom, #ff758c, #ff7eb3);
    font-family: -apple-system, BlinkMacSystemFont, 'Arial', sans-serif;
    text-align: center;
    touch-action: none;
    position: fixed;
    width: 100%;
    height: 100vh;
    height: 100dvh;
    /* Prevent Safari elastic bounce */
    overscroll-behavior: none;
}

/* Header */
.header {
    position: relative;
    z-index: 100;
    padding: 10px 15px;
    padding-top: max(10px, env(safe-area-inset-top, 10px));
    background: rgba(0,0,0,0.2);
}

h1 {
    color: white;
    font-size: 22px;
    text-shadow: 2px 2px 8px rgba(0,0,0,0.4);
    margin-bottom: 5px;
}

#scoreBoard {
    display: flex;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
}

.stat {
    color: white;
    font-size: 16px;
    font-weight: bold;
    text-shadow: 1px 1px 4px rgba(0,0,0,0.3);
}

#combo {
    color: #FFD700;
    font-size: 20px;
    transform: scale(1);
    transition: transform 0.2s;
}

#combo.pulse {
    transform: scale(1.3);
}

/* Sparkles */
.sparkle {
    position: absolute;
    width: 6px;
    height: 6px;
    background: white;
    border-radius: 50%;
    opacity: 0.8;
    animation: sparkleFloat 4s linear infinite;
    pointer-events: none;
}

@keyframes sparkleFloat {
    from { transform: translateY(100vh) scale(0.5); opacity: 0; }
    50% { opacity: 1; }
    to { transform: translateY(-10vh) scale(1.2); opacity: 0; }
}

#gameArea {
    position: relative;
    width: 100vw;
    /* Fallback for older Safari, then use dvh */
    height: calc(100vh - 100px);
    height: calc(100dvh - 100px);
    overflow: hidden;
}

/* Hearts and Items */
.heart, .powerup, .bomb {
    position: absolute;
    font-size: 28px;
    animation: fall linear;
    cursor: pointer;
    user-select: none;
}

.powerup {
    font-size: 32px;
    animation: fall linear, starPulse 0.6s ease-in-out infinite alternate;
}

@keyframes starPulse {
    from { filter: brightness(1) drop-shadow(0 0 4px rgba(255,220,0,0.6)); }
    to   { filter: brightness(1.5) drop-shadow(0 0 12px rgba(255,220,0,1)); }
}

.bomb {
    font-size: 30px;
    animation: fallWobble linear;
}

@keyframes fall {
    from { transform: translateY(-50px); }
    to { transform: translateY(calc(100vh + 50px)); }
}


@keyframes fallWobble {
    from { transform: translateY(-50px) rotate(-5deg); }
    25% { transform: translateY(calc(25vh)) rotate(5deg); }
    50% { transform: translateY(calc(50vh)) rotate(-5deg); }
    75% { transform: translateY(calc(75vh)) rotate(5deg); }
    to { transform: translateY(calc(100vh + 50px)) rotate(-5deg); }
}

#basket {
    position: absolute;
    bottom: max(20px, env(safe-area-inset-bottom, 20px) + 10px);
    left: 50%;
    transform: translateX(-50%);
    filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
    z-index: 10;
    touch-action: none;
    will-change: transform;
    -webkit-transform: translateX(-50%);
}

#basket.invincible img {
    animation: shieldGlow 0.4s ease-in-out infinite alternate;
    border-color: gold !important;
}

@keyframes shieldGlow {
    from { box-shadow: 0 0 8px 2px rgba(255, 215, 0, 0.6); }
    to   { box-shadow: 0 0 20px 6px rgba(255, 215, 0, 1); }
}

/* Messages */
#message {
    position: absolute;
    top: 35%;
    width: 100%;
    font-size: 28px;
    color: white;
    display: none;
    padding: 0 20px;
    animation: fadeIn 2s ease-in-out;
    text-shadow: 2px 2px 8px rgba(0,0,0,0.5);
}

#popupText {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 48px;
    font-weight: bold;
    color: #FFD700;
    text-shadow: 3px 3px 10px rgba(0,0,0,0.8);
    opacity: 0;
    pointer-events: none;
    z-index: 1000;
}

.loveText {
    position: absolute;
    color: white;
    font-size: 16px;
    opacity: 0.8;
    animation: floatLove 6s linear forwards;
    text-shadow: 1px 1px 4px rgba(0,0,0,0.4);
    pointer-events: none;
}

@keyframes floatLove {
    from { transform: translateY(100vh); opacity: 0; }
    20% { opacity: 1; }
    to { transform: translateY(-20vh); opacity: 0; }
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* Back button */
.backBtn {
    position: absolute;
    top: max(15px, env(safe-area-inset-top, 0px) + 8px);
    left: max(15px, env(safe-area-inset-left, 0px) + 10px);
    padding: 10px 20px;
    background: rgba(255,255,255,0.3);
    border: 2px solid white;
    border-radius: 20px;
    color: white;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    text-decoration: none;
    z-index: 101;
    transition: all 0.2s;
    touch-action: manipulation;
    -webkit-user-select: none;
    user-select: none;
    min-height: 44px;
    display: flex;
    align-items: center;
}

.backBtn:active {
    transform: scale(0.95);
    background: rgba(255,255,255,0.5);
}

/* Difficulty selector */
#difficultySelect {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(255,255,255,0.95);
    padding: 25px 20px;
    border-radius: 20px;
    z-index: 1000;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    width: min(320px, 90vw);
}

#difficultySelect h2 {
    color: #ff758c;
    margin-bottom: 20px;
}

.diffBtn {
    display: block;
    width: 100%;
    margin: 10px auto;
    padding: 15px;
    background: linear-gradient(145deg, #ff758c, #ff7eb3);
    border: none;
    border-radius: 10px;
    color: white;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    transition: transform 0.15s;
    touch-action: manipulation;
    -webkit-user-select: none;
    user-select: none;
    min-height: 54px;
    -webkit-appearance: none;
    appearance: none;
}
</style>
</head>

<body>

<a href="index.html" class="backBtn">‚Üê Back</a>

<div id="difficultySelect">
    <h2>Choose Your Challenge!</h2>
    <button class="diffBtn" onclick="startGame('easy')">üòä Easy - Chill Vibes</button>
    <button class="diffBtn" onclick="startGame('normal')">üòé Normal - Fun Times</button>
    <button class="diffBtn" onclick="startGame('hard')">üî• Hard - Pro Catcher!</button>
</div>

<div class="header">
    <h1>Catch the Love, Beatrix ‚ù§Ô∏è</h1>
    <div id="scoreBoard">
        <div class="stat">‚ù§Ô∏è <span id="score">0</span></div>
        <div class="stat">‚ö° <span id="streak">0</span></div>
        <div class="stat" id="combo"></div>
    </div>
</div>

<div id="gameArea">
    <div id="basket"><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDAAUDBAQEAwUEBAQFBQUGBwwIBwcHBw8LCwkMEQ8SEhEPERETFhwXExQaFRERGCEYGh0dHx8fExciJCIeJBweHx7/2wBDAQUFBQcGBw4ICA4eFBEUHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCACuAJEDASIAAhEBAxEB/8QAHQAAAgIDAQEBAAAAAAAAAAAAAAYFBwMECAkCAf/EAEYQAAEDAwMBBgMFBAgBDQAAAAECAwQABREGEiExBxMiQVFhcYGRCBQjMqEzQlKxFWJygsHR4fAWGCQlQ1NUVnODk5Sisv/EABkBAAMBAQEAAAAAAAAAAAAAAAADBAIFAf/EACMRAAMAAgICAgMBAQAAAAAAAAABAgMREiEEMSJRE0FhgSP/2gAMAwEAAhEDEQA/AOy6KKKACiiigAooooAKjNTags2mrWu5Xy4MQYqON7iuVH0SOpPsKiu0zW9n0Fppy8XZzKidkaOk+N9z+Ee3mT5D5A8QdqOvb9ryQu6XiUY8VRIZQCQkJ9G0non+t5ms1WjcxtbLU7UftYSUPv27QVobBSCDNmDcpJ9Q2OB/eJ+Fcw6o1jqS/wBzdn3q/wBzuDzqtyi/JWpOfQJztSB6AAVHXB5G3uI6e6jp5HPKvcnzJrVjsrWNxQQk9CrivPfbPOh47Oe1jVWiLkibZL5OadQsFUSS8p2HJT5ocbJ8PnhScEZrvPsH7T7d2paMF4jsJhXGMvuLhC7zf3LmMgg+aFDlJx6jqDXmZI2lfT4UxdnOs9U6L1GxeNMXJ2FLRgODJLb6QcltxPRST9R5YNeyjL6PVKiq57D+1zT/AGoWdSoZEK9RUJM+2uKytvPG9B/fbJ6KHwODVjVoAooooAKKKKACiiigAooooAKKKKACtW7XCHarbIuM99DEWOguOuKPAA/mfbzraqjvtFXxyalVljPYjQilT6Qf2r5GUp+CUnJ91D0rynpGpnkyj+1XUcvtE1NLvc8OJtkZRbiRirASgc7fY/vKP+lVBd3HritU5891DB2xk7f2wBxlA/gHl61Yuou7ZjIiPIKmUkJeYT+Z5R8Xd/Pqr0AxSJqRL86cSQndgcJ4S2BwlAFMnF1tmKybev0QMaCFhyU6nc22rABPCjUbNdWXNgUCVDwgdMeVNd5ZZZaRbWSChkBCxn86uqyfngVmsOk3brIK9qiVDrilV09Gkm10I8aMtz8ySQk9ff39Kk41ulxiqRs8I5Vu6CrClaLk2pHfR2dx/hUjPyPtS9KlSIMrK2khKeFtL5SR/D8PT0rUufsxU0ZtF3a7WXVEK/WKSbfd4CiuO4k4Sv8AibWOhQocEeY98GvQzst1nbtfaKg6kt/4ffAtyY5OVR308ONK9wfqCD5153yXY0R0PR/FFeCSEqOSjPv6CrW+x9r57TvawdOTJH/RWpfwQCfCiYhP4Sx6FaQUH1Oz0pfJ8/4alfE7hooopgBRRRQAUUUUAFFFFABRRRQBhnSW4cJ6U6QEMtqWrJxwBmuYNcOPpkF15JclOOlxQPVyQ6rIT8BwPgmr87S5bTNjbiuLx95eSFD1Qk7lfLgD51Q19WudeHJClFtUQq7ogZPfuDAVjz2pJPxIpNPdpfQ+FrG39lXarYQ2t2U2pSygFhk+aiT+I4B6qVx8AKV4yE25G9xsGS4PATzhR5zn2FON2LSZLinwlmHEGz1zg4yfU9fnmkd1EyfdmxFjuYfymCzjlDeeXD/vqa6C1rZDa70jXtFjk3O7pioCnCrKnF+qicnP+/Krz0lpcQWmgpvG0DnHJqb7JezpVvs33mWye/XhQURzTlJiNxlhGAMjp6VFlTT2XYl1oSL1bwUkJR1GOlVL2h2IBK1lsbs84FdCvNNPJWkgcVXmv40fudzikAq4AUQM1Hkde0UQk+mc5KSAlEVZPCSBny5rD96estyi3OMtaXoTzUtpSTghSFBY/UVN6rt7cWQ4608hRTnYArrnjn9aUn5gfWkuZwrKVD2qqXyjZJa41o9VLROZudph3KOcsy2EPtn+qtIUP0NbVVt9mG9m/dhGlZTjvePsQxDe5yQpklvB+SQfnVk01CwooooAKKKKACiiigAoooJAGTwKAKw7Sbk07qRUQZJiRxk9QCTnHz4+lVDdHFwEl905cQF7FL4T3izlbh+AA+gplts5y7vXi6v7iqfMd7vnoylSgDnp0qpu22+IVEehtulJcGXCDghodQPQqxj4VJjrlTZbklRC3+hJ11eCdNPX1oJMdmSI6W0glBdVylG4cbgg7yD5H1NSnYeNcXu3S7npe36bTN3bfvV2eASQPQFWcDywMVV4uU64dnl1tLcJBjs3aPK71KlZQVIUjbjO3B45wDxjJqztK9kV7u3ZlY9Q268riMTIxLqUZGFJWpJSSDz0qusjfolx499kzfe0PtM0zcFxZ2q9HPyyBvDEskJUfIYyABWdvtH7Q3oa5twtibgywQtb1rdTJAQPzFSOFYA54zSW72XuK2NIlpy0r8jUYHefdR5q4exPTg0/cm35qg0GlhwYGMc9CPIc/OscnXR4pqO2jTvmuzF0zDu8J5iTHno7xh9tWUkeefQg8EHkVR2rtXXbU7zkpaiiKn9m44pSUrA67UjkismtdA32dZdQdoEFlUfTy7tJ+6tNghCm+9V4gkHGOgyBjpUmNHyrjbYk9EJMuI/HbcaLbowUlIx0OQfKkVljG/kyj8V2vihMTcPAgTn2lN54aSypsKH9rOahJCHj94AbacVGT3q1AkEoJAz15wSPrV0J0GX7Ylb8BEGOwMnd41q9ufekXVOnHLRZbrfEIP3QsNwgryLjjoISPfahZx7VvFlm64mMmC4nkzp/7AuqmJWnb5pDOxcRxu4sNlRUUtvDasbj1wtGf79dP15yfZB1V/wr252Vbrqkw7qDa5GDgfiY7sn4OJR9a9G6dPoQFFFFegFFFFABRRRQAVBdoE82zRN4mhWxTcRwJPoojaPnkip2qy+0XcVxdHQoDTwbXPuDSFf+WjK1E+w2j9KxdcZbN455WkV7c20WvSrLCCUNtspZ49Dycn4CuWe1G8uXC8rjL4Mj8U89EDy9vIfWultbTEKtZaSQ0kPg4x/Vwn+Vcp9o0fuNUvuerYQTS/HhIb5OR10Wl9mfRsbWFk1/p555MQT4UZtiRs3fd3gpSkrx54IGR6Zpq7H9YSuyeLceyTtZZFmBeckWe4rSVRV7+VAOYwW1HxJV5EkKxWP7GqlIlaka27d8eM6g+viUDXQl1dhz4Jg3OBFuDA/6qUwh5GT6BQIFNfTZjHXwRVca76dj29csXa1EEklQlN4/nUCzdJOsVv2HRDhlz5LiWZU9AzGtsc/tHFr6KcKcpQgZ6knGBW1H0bata6ylW+NpiyWy0wlYkOswG0KUrP5RgdatizWSPpS1uwdPqRBQ5g47kKSCBgHHH0rOOf2hmWt9M+rzabXA0bD06iOkW2NFEZLbicBaMYOR781zBKsk3s9luRJzj504p1a7VMbQXNoJ3GO6kcpI5IVgg1efaHJ1DcbYhqKsSHkHxhR2cD0Hx8qqzUdp1Mu1tf0sovsoUV7RjwE+ZA9q5fmbnNv9M6XiNXi/qNeZr6yPWtLMcz5bqk8NxoDrhz5Z4A/Wq/7W2NUTNERp0qALLpyFKT92gvuhUmVId8K5LoTwDhISkdEp4HUkz1pmqgSnIaXF8jKU54961+2t9xPZmw1KV+JIuDSWkg+SQpRr2PIc3MyvbMZMKvHVU/SKp02XY0lEtnIdZWl1oj+NJ3JP1Ar1W07cE3bT9uuqcBMyK1IGOnjQFf415f6RipcbVuxwpPUexr0p7K2nWOzTTLL37RNqjBX/ALaa6GOt2zmXOpQy0UUU8UFFFFABRRRQAVSXbvNRcdW260pAW3b0Jcd/tuKBCR68ITn2NXDernEs9sfuM50NsMpyT5k+QHqT0ArmpvULd11mtLrgVKU6uZMG8EtjBIBPl4QAPQCpvJvSU/ZT40bfIhNfyHEOGOF5ztxk/mIJBNUR2psFyYZI24cZSoECrt1yFvPtr/KrG3p0HUn61WevIP3mxxpKSFBKFJz5+E8g/AHNMwi8yNP7KmsRp/tchwbi+UQruwq2krV4ULJCmj7DcMf3q7OfTtcO5JT5EH1Fec8uApSwW1qSoeJK0qwpJBzn5GuuewLtaGtrO1p3UbqW9TRWwkPdE3BCRwsejmPzDz6jzrd/ZnH9Evam9dxGrzH0mm1iQ3cFurVNQSXm1YOE46KxnBPFTyVT72yxEc1tJgPuja43IittlC9uSlJHChnjNM0OMI0h50Dl4DcfcVB6q063ckrfjvJivqHjStve057kdQfcUY2+Ohy1y2+hP1F2famUwyWO0BAbfbK3FKONuM5SMK8R+lUnqDTN5dZ+6Q5s55+Q6E/eFvFtJAJ3d2nqo8fAVYl/s2qIThDCoDpGQgpJO34AjisOn7ZMRJVcJ7j0iZjYlS84bT/CkeVcrzsjjTO14mNNNc9/5oUrBa0xHXI7za++ZUE7nDlXTrnzpF7Zb4i8X+JZYqgpi1A94fIvr6j+6nA+tPXazqQaag5jKSq6SiUsIPPxWfYfzxVOWaMXHkKcUVKJU64pRySc8k+tY8OHf/av8JfMtQvwT+/Y1aVhn+i3ioYWpOUj5f616QaRBTpOzpIwRBYGP/TTXnvpJhyVOhxIwy666hptvH7yzj9OBXorbmPutvjRuPwWkt8ewAq/xu22c7PPFJGeiiiqycKKKKAClLW/aHpnSbLgmzUyZqQSIUYhbx+Iz4R7nFcn2/ta13qnwXrU0p7vs7YcBCIqQ2R145cIPlnpVeXhd1YvffRi+px1wl11PBUjPQk9KxldQ+KQzHMtbbLF7Y+1e/awDa23HY8VanEMQIyshBBIBV5qUfXgfADn60zERaGru2C25Lk9yhaz1wUpKk+pPAHwx60lTtrt7jutby8wC88ls8NJOM8/X/ZpnhXdEKDIushvDz6w1FSrnakKBWtXuVYGfRFROXvsrlrRN6nmNAvYWfw0FGSeCoglQ+XOfjSRKcaXazEcUSyXSUO5ztURgk+3UVhvl0+7Qn47q1OFS/zHnAPKj8VHHyFQypq1w0xlOYUtYcJHnz0+AzVmOWvZDkvkxKntmO8VtqytpRDiSPzA56f50wdn6ynUDTyHFpW05kK/KpJHQgioa4kPypKU+RKvlny+ta1omLiykqBIWg7Tz5eX+Ve2tozL+R2ppHWjslpDNzBWoAYkAfn/ALQ9fendMqJIjhxCkqSocEHPPvXOWhtQtogtuLWCcD41IXPUcz7wkWqQ+w4sjJbPB+XSkzk10UNFrXox2nNxCcH9Kq/XmvrHpqI9Lkubz0aZbAK3V/wgf4+VV72r65v0OWm3xLgQe7HeKKQSVVTr4l3CY9MnPuSHVEAKcOSPh6UnL4y8hrb6KMfmPBPS7Nm7XS4ajvsm+XEgvOcIbHKWk/uoT7D9etSWn2QJClqyW0IBXjyQPL5mtO2Rv+avFWfCoHOOlM1thKZsZeKeJCwAfYdP1p2WVMJT6Jcdu65P2OvYg8lvtP0w7JA2ru7JX6AEkJHyJFd/15zWBLiJIeYWWnW1IW0sdUrCgUkfMV3Z2Uazia20hFuaFtJnoQG58ZKsqYeA5BHkD1HsaX4lrbkf5UvSobaKKKtIwooooA8vGFsb4wUgqcV4MJO3YAMnn39ql7bcbi5FT+OlSnCCpO3hKM/hoyeev1pIizFkMpClJSgqwPPkevxp2sC2g9a0ttEtxWTOdA4Cu7yQVfPbx7VVmjn2Lx3p6GC3NuNOybNFC25LxxKf3bi2dwIQPfOePY+lY9RuqM3uWtyW4+Gkp6kbf8M/U/Gs9jebtWlnLi+6fvsh5111auiieMg+vJ+ppPiSVbUOFxSmkOFlBKsncSVdfTHNTRg5PbHXn0tI2Lm9IkIkhR8ZfSPQEZOPrWip/ukKKMKeC0hIPBAHIHzPPwHvUhPJZiSFoQCspCwR1HOf5Go8xy3PTuG5JdyonnORQ1pk6eyLcQd5dQoqCk8n4HpWtHjqXIkHHHJSR7c81LsM5u64wGE7jjI8qzGKWZS0bcAjKSPP2pdvSHQls2LXJfZipW3JURjBTT1pF91yOuZIdJCBx60htsp2KKTs4ztx1pgsM4NW5TLiXCpQOAkjgVHyTor4aQlaokO3C+SHiokbzt9xmtmHb9tp71xOzLis/ADn9eKlH7RHixxPmHapHi28E9c/XFajUs3G2NlCEttrK9iR0CN+M/PBqzEutkWV9mNiKtm1lZRtLhSQB1Ocgf79qcbO2h3S6EFJUppzYBj9T/vyqMv0ZpqLDbSFErSSCRjOAMED05rds73d2KCWyfE+gk56kFQNGRfFhjrtG1ZEAMvOkje2Mj3wea/I2o71pTU6bzaLg/Bf57t5s4weoC09FoOcbVAj0xWayjF5lRQvahQUoZ9D1/XFaepIrT8Fh5edgw0vnoMcE+4wD8q5OuFHYT5QdL9lX2ltM3ws2nWwb03dyQgPLJ+5vq9Qs/s8+i+Pc1fTLjbzSHmXEuNrSFIWk5CgeQQfMV5d3cLU0224kd5gtk4/NwevsRTx2IdtOqey94RWN130+seO1yHilLRzncyrB7s9fD+U+gPNdXFXKds5uSeLPQ6iuY/+WHp3/wAD3z/5DP8AnRTBezjWAlLz2HMpSv8AKvbnafLPtTNb5ZatTsEAh5x5pClf1AolQA+gPlik5Dq29rrC1JSTnr+hphAKI6JiXFFwgnO7PNdCFsjoee1pSIFot0KIspZLKVAJ6lO4/rnPNJen5bUh5VoGSqSjdHWrjDic+Ej1UMj6Vm1dd3Li204ThPdjwH9zjhI/X60pyXMOpW26WVjaW1Afl9+KTVaR7CbLKtDCnpbcdwDLjSmhnnnGMn54rBcI+YzlvTw7HQAFD94JyCfc1NW91TsWPLaTtkjxOHGeeAePc8/OsV0SI09LygN6hhYJyc55FK2vbNLZFLjhbkKayCC8zhwD91YH8iK+3G0vNhwc7Uggjz8jX01IbirS0nxBLu4AeYJP8q/GjtiyEoClbHz4uvHlUudlWFNsxx4633Q2wjceqgPIDqT7Vshp2JILb6AlScHAPGD0Oa+iyptXesqUgnzHUUoazvq23FwWHyuQf27uc7f6vx/lUWOXdaRZkpTOzNqa+pu0z+jYygGGgQtw8bz5/IVt2ZnbIjHAKFFW1PkhIRnHwGR86Qo6i2oqQSVEY+NW5oiPHuN/Zt7h2thtSSDzhsAqI/tEA12McpLSORlb9mzqx3bNtzQOS2G4z2eAFEBSs/8A1rNBR91tE2M6kB2G/HO0cY3df/1Svdpi5t2iFtRKDJ3L387PEFKJ+WB9KZ5f49y1THKtxUiME4HVRWMfoKxlS0axb2ZklUe/If53MrG4H+BQ9PjWzekJEGQxvyEKJOOqcnhXyzWK9qQZLLjage+jNKz5EY6/UVhu74bUoqHQjHv4eR8K4+We9nYw2hfkRFzrOy4lH48dexaR1UMHp78ZHtSmtaSTg8U3yXjEsl0bSoBSEIcac687h/LNKc3bICZwHdqcJ70fuhfmQPLPX41X4m2mT+Trl0Y8+xorX3n/ALwP1oqvTJtGKJCdeuCu7wGiCXFHoPes70gttllB6DHSpmDH7i1KJ/MsZNL0rPfKz611rx/jnf2RKuTMKnFrVlairy5r5Ql16eww2VBS1AcdefOvxwhPJ4FS2io6Zt1OdqVMJ3JWVYHPlXOz0plsohbaLU0DFDr6og/GAZ2+E4BPl7+1bGrrYYjqCsYJSVEkYxTVo/TL9p06iY622l538XKwR4fc0v6ncfkXNLrxacb2qUE5yFeQGfSo1Ta2Ocreivn0rYUXD+VRUsH0GcfzqaskZTlsdXt8TxASB5nFfFygobikSHmm20jctxSvCgZ6k+/pS3fdblqIbbp9KmQQUrmKThf9weWfU8/Ck5Zu2pkfiuIW6NrWupEWpv8AomApLs9KAl10chn1+Kv5VW4ScnJJ5ySecmspSSSTnJOSfU+tATg1VixKFpE2TK7ez7iBIkIUseBJyadtFXKRb3Lleg4UNJSUMoH8ak7R9ASaSE+HzI+FMNslOOWbu1qO1Lh7tGfCn396t8ee3snv0bq1p/CS0gnapDYWpWFOKKgVED4+VON0mot2pJLTidqp9zSNwPCW2U/hk/FZPypAtLLjtwjd6S2kSUZWfLxDoPM+mKldXy3Zmspa/EUpklCE5zjBzmk5fZuB8uaFoVDCweAtBGPIKVj9DUTqR8Ktr0gHG1ZGR7IH61K32QlW51SuENqXuB4zgf4mlHVTym9OMpWrIlyFK4PQYH+Vc6lzrReq4o15r/e6efexy5HQhSfeoGOpbFvWjON5SpPqDzmtma6UWxmGFJT3iAVZ6Dnj9BUetJaZQkuhaDyOMEVXhx8UT3fI/e9X/wBt+gorQ70+iqKdpmB0kkojbOOlLMzHeqNMU84QfWlqcrxqHpXX8p9EWM0Jbg6VZf2aNGXLWWrXS1FW5boGx2Y5jCCAchGfc/pVVvqJVg1LQnZMeAWGZclpl3lbbTykJUfcAgH51ybn8j0Up8TsLtJj2thlLV+1rpqzoz4WzI3lvHTDaCVKPxHyrn3V+rLIxOcaszs+9OJPD8lv7swD6hHK1fE4qvGwlpRU2kJUepHU0HmvFhlHnNs3r1ebneQf6QlbkJwG2UJCW0jOeEj/ABzUaGkgdDWQUVvikeLZ892K/Ftp8h86+6D0r3R6aaxgn0qctiCmzIOCMqJqGcGSano3hs7A9Rmn4F7f8F2fEBwNXCO5uJU24FZJ4ABzUpp62Pz7uJ6wQyF95vUcAqPOPf8A1qC74svbwlKsHOFDNb7eopKYymmwQo4Tu6YHoPSpMkul0Ol8Rpuk1Lu6N3mEAhlSupP7y/r5UuatuAlPMMMKHdsJKU/PFar8t99tCSoITndhP0x+lYg2FKJPrWcXjd7ZqsuzAhklIKtxUT5+dfE1YDqWx+4mt/AHl0GahnFFbjjh9aoueOhc9sxZor8x70Vgaf/Z" style="height:90px;width:auto;display:block;filter:drop-shadow(0 4px 10px rgba(0,0,0,0.5));"></div>
    <div id="message">Beatrix, I Love You Forever ‚ù§Ô∏è</div>
    <div id="popupText"></div>
</div>

<audio id="bgMusic" loop>
    <source src="1.mp3" type="audio/mpeg">
</audio>

<script>
let score = 0;
let streak = 0;
let maxStreak = 0;
let combo = 0;
let invincible = false;
let speedBoost = false;
let gameStarted = false;
let difficulty = 'normal';

const basket = document.getElementById("basket");
const gameArea = document.getElementById("gameArea");
const scoreDisplay = document.getElementById("score");
const streakDisplay = document.getElementById("streak");
const comboDisplay = document.getElementById("combo");
const message = document.getElementById("message");
const music = document.getElementById("bgMusic");
const popupText = document.getElementById("popupText");

let spawnInterval;
let basketSpeed = 1;

const loveMessages = [
    "You are my forever ‚ù§Ô∏è",
    "My heart is yours üíï",
    "You are my dream ‚ú®",
    "Always and forever üíñ",
    "My beautiful Beatrix üí´",
    "You complete me üåü",
    "Forever yours üíù",
    "You're amazing! üéâ"
];

const funnyMessages = [
    "BOINK! üòÑ",
    "Nice catch! üéØ",
    "Smooth! üòé",
    "On fire! üî•",
    "Wow! ‚ö°",
    "Perfect! ‚ú®",
    "Combo! üí•",
    "Streak! üåü"
];

// Lazy AudioContext ‚Äî Safari requires user gesture before creation
let audioContext = null;

function getAudioContext() {
    if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
    }
    if (audioContext.state === 'suspended') {
        audioContext.resume();
    }
    return audioContext;
}

function playSound(type) {
    try {
        if (typeof AudioContext === 'undefined' && typeof webkitAudioContext === 'undefined') return;
        const audioContext = getAudioContext();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        switch(type) {
            case 'catch':
                oscillator.type = 'sine';
                oscillator.frequency.value = 800 + (combo * 50);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
                break;
                
            case 'powerup':
                oscillator.type = 'square';
                oscillator.frequency.value = 600;
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                oscillator.start(audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.2);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                oscillator.stop(audioContext.currentTime + 0.2);
                break;
                
            case 'bomb':
                oscillator.type = 'sawtooth';
                oscillator.frequency.value = 100;
                gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
                break;
                
            case 'combo':
                for (let i = 0; i < 3; i++) {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();
                    osc.connect(gain);
                    gain.connect(audioContext.destination);
                    osc.type = 'sine';
                    osc.frequency.value = 800 + (i * 200);
                    gain.gain.setValueAtTime(0.2, audioContext.currentTime + i * 0.05);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.05 + 0.1);
                    osc.start(audioContext.currentTime + i * 0.05);
                    osc.stop(audioContext.currentTime + i * 0.05 + 0.1);
                }
                break;
                
            case 'win':
                const notes = [523.25, 587.33, 659.25, 783.99, 880.00];
                notes.forEach((freq, i) => {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();
                    osc.connect(gain);
                    gain.connect(audioContext.destination);
                    osc.type = 'sine';
                    osc.frequency.value = freq;
                    gain.gain.setValueAtTime(0.2, audioContext.currentTime + i * 0.1);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.1 + 0.3);
                    osc.start(audioContext.currentTime + i * 0.1);
                    osc.stop(audioContext.currentTime + i * 0.1 + 0.3);
                });
                break;
                
            case 'easteregg':
                // Funny painful "OW!" sound
                oscillator.type = 'sawtooth';
                oscillator.frequency.value = 400;
                gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
                oscillator.start(audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(150, audioContext.currentTime + 0.2);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                oscillator.stop(audioContext.currentTime + 0.2);
                break;
                
            case 'spawn':
                // Funny bouncy "BOING!" sound when it appears
                oscillator.type = 'sine';
                oscillator.frequency.value = 200;
                gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
                oscillator.start(audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(600, audioContext.currentTime + 0.15);
                oscillator.frequency.exponentialRampToValueAtTime(300, audioContext.currentTime + 0.25);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.25);
                oscillator.stop(audioContext.currentTime + 0.25);
                break;
        }
        
        if (window.navigator.vibrate) {
            if (type === 'catch') window.navigator.vibrate(10);
            if (type === 'powerup') window.navigator.vibrate([20, 50, 20]);
            if (type === 'bomb') window.navigator.vibrate(200);
            if (type === 'combo') window.navigator.vibrate([10, 30, 10, 30, 10]);
            if (type === 'easteregg') window.navigator.vibrate(300); // Long painful vibration
        }
    } catch(e) {
        console.log('Sound error:', e);
    }
}

function startGame(diff) {
    difficulty = diff;
    gameStarted = true;
    document.getElementById('difficultySelect').style.display = 'none';

    // Init AudioContext on user gesture (Safari requirement)
    getAudioContext();
    music.play().catch(e => console.log('Music play failed:', e));

    let spawnRate = 800;
    if (diff === 'easy') spawnRate = 1200;
    if (diff === 'hard') spawnRate = 500;

    spawnInterval = setInterval(createItem, spawnRate);
    setInterval(createSparkle, 300);
    setInterval(createLoveText, 3000);

    // Start the single shared collision loop
    startCollisionLoop();
}

/* Smooth transform-based basket control */
let basketX = window.innerWidth / 2;
let rafMoveScheduled = false;

function getGameWidth() {
    return window.visualViewport ? window.visualViewport.width : window.innerWidth;
}

function setBasketX(clientX) {
    const halfBasket = 40;
    const w = getGameWidth();
    basketX = Math.max(halfBasket, Math.min(w - halfBasket, clientX));
    if (!rafMoveScheduled) {
        rafMoveScheduled = true;
        requestAnimationFrame(applyBasketTransform);
    }
}

function applyBasketTransform() {
    // Transform from center (basket is left:50%), offset by finger delta from center
    const offsetFromCenter = basketX - getGameWidth() / 2;
    basket.style.transform = `translateX(calc(-50% + ${offsetFromCenter}px))`;
    basket.style.webkitTransform = `translateX(calc(-50% + ${offsetFromCenter}px))`;
    rafMoveScheduled = false;
}

document.addEventListener("touchmove", (e) => {
    e.preventDefault();
    setBasketX(e.touches[0].clientX);
}, { passive: false });

document.addEventListener("mousemove", (e) => {
    setBasketX(e.clientX);
});

function updateBasketPosition() {
    // Legacy alias kept for any calls elsewhere
    applyBasketTransform();
}

// Resume AudioContext on first touch (Safari requirement)
document.addEventListener("touchstart", () => {
    getAudioContext();
    if (gameStarted) music.play().catch(() => {});
}, { passive: true, once: true });

/* Create falling items */
function createItem() {
    const rand = Math.random();
    let item;
    
    if (rand < 0.25) {
        // Regular heart
        item = createHeart();
    } else if (rand < 0.35) {
        // Power-up
        item = createPowerup();
    } else if (rand < 0.40) {
        // Bomb
        item = createBomb();
    } else {
        // Flying penis easter egg (60% chance - it's EVERYWHERE!)
        item = createEasterEgg();
    }
}

function createHeart() {
    const heart = document.createElement("div");
    heart.classList.add("heart");
    const hearts = ["‚ù§Ô∏è", "üíï", "üíñ", "üíó", "üíì", "üíù"];
    heart.innerHTML = hearts[Math.floor(Math.random() * hearts.length)];
    heart.style.left = Math.random() * (getGameWidth() - 50) + "px";
    heart.style.animationDuration = (2 + Math.random() * 2) + "s";
    if (difficulty === 'hard') heart.style.animationDuration = (1.5 + Math.random() * 1) + "s";
    if (difficulty === 'easy') heart.style.animationDuration = (3 + Math.random() * 2) + "s";
    gameArea.appendChild(heart);
    activeItems.push({ el: heart, type: 'heart' });
}

function createPowerup() {
    const powerup = document.createElement("div");
    powerup.classList.add("powerup");
    const powerups = ["‚≠ê", "üí´", "‚ú®", "üåü"];
    powerup.innerHTML = powerups[Math.floor(Math.random() * powerups.length)];
    powerup.style.left = Math.random() * (getGameWidth() - 50) + "px";
    const fallDuration = (2 + Math.random() * 2).toFixed(2) + "s";
    powerup.style.animationDuration = fallDuration + ", 0.6s";
    gameArea.appendChild(powerup);
    activeItems.push({ el: powerup, type: 'powerup' });
}

function createBomb() {
    const bomb = document.createElement("div");
    bomb.classList.add("bomb");
    bomb.innerHTML = "üí£";
    bomb.style.left = Math.random() * (getGameWidth() - 50) + "px";
    bomb.style.animationDuration = (2 + Math.random() * 1.5) + "s";
    gameArea.appendChild(bomb);
    activeItems.push({ el: bomb, type: 'bomb' });
}

function createEasterEgg() {
    const egg = document.createElement("div");
    egg.classList.add("bomb");
    egg.innerHTML = "üçÜ";
    egg.style.left = Math.random() * (getGameWidth() - 50) + "px";
    egg.style.animationDuration = (1.5 + Math.random() * 1) + "s";
    egg.style.fontSize = "35px";
    gameArea.appendChild(egg);
    playSound('spawn');
    activeItems.push({ el: egg, type: 'easteregg' });
}

/* Unified RAF-based collision loop ‚Äî replaces per-item setInterval */
let activeItems = []; // { el, type }
let collisionLoopRunning = false;

function startCollisionLoop() {
    if (collisionLoopRunning) return;
    collisionLoopRunning = true;
    rafCollisionLoop();
}

function rafCollisionLoop() {
    if (!gameStarted) { collisionLoopRunning = false; return; }

    const basketRect = basket.getBoundingClientRect();
    const viewH = window.visualViewport ? window.visualViewport.height : window.innerHeight;

    for (let i = activeItems.length - 1; i >= 0; i--) {
        const { el, type } = activeItems[i];
        const itemRect = el.getBoundingClientRect();

        // Caught
        if (
            itemRect.bottom >= basketRect.top &&
            itemRect.left < basketRect.right &&
            itemRect.right > basketRect.left
        ) {
            handleCatch(type);
            el.remove();
            activeItems.splice(i, 1);
            continue;
        }

        // Missed ‚Äî fell off screen
        if (itemRect.top > viewH) {
            el.remove();
            activeItems.splice(i, 1);
            if (type === 'heart') {
                streak = 0;
                combo = 0;
                streakDisplay.textContent = streak;
                comboDisplay.textContent = "";
            }
        }
    }

    requestAnimationFrame(rafCollisionLoop);
}

function handleCatch(type) {
    if (type === 'heart') {
        score++;
        streak++;
        combo++;
        scoreDisplay.textContent = score;
        streakDisplay.textContent = streak;

        if (combo > 2) {
            comboDisplay.textContent = `${combo}x COMBO!`;
            comboDisplay.classList.add('pulse');
            setTimeout(() => comboDisplay.classList.remove('pulse'), 200);
            playSound('combo');
            showPopup(funnyMessages[Math.floor(Math.random() * funnyMessages.length)]);
        } else {
            playSound('catch');
        }

        if (streak > maxStreak) maxStreak = streak;

    } else if (type === 'powerup') {
        score += 5;
        scoreDisplay.textContent = score;
        playSound('powerup');
        showPopup("‚≠ê +5 BONUS! ‚≠ê");
        activatePowerup();

    } else if (type === 'bomb') {
        if (!invincible) {
            score = Math.max(0, score - 3);
            streak = 0; combo = 0;
            scoreDisplay.textContent = score;
            streakDisplay.textContent = streak;
            comboDisplay.textContent = "";
            playSound('bomb');
            showPopup("üí• OOPS! -3");
        } else {
            showPopup("üõ°Ô∏è PROTECTED!");
        }

    } else if (type === 'easteregg') {
        score = Math.max(0, score - 5);
        streak = 0; combo = 0;
        scoreDisplay.textContent = score;
        streakDisplay.textContent = streak;
        comboDisplay.textContent = "";
        playSound('easteregg');
        showPopup("üçÜ OUCH! -5 üòÇ");
    }

    if (score >= 30) {
        message.style.display = "block";
        clearInterval(spawnInterval);
        gameStarted = false;
        playSound('win');
        showPopup("üéâ YOU WIN! üéâ");
    }
}

function activatePowerup() {
    invincible = true;
    basket.classList.add('invincible');
    setTimeout(() => {
        invincible = false;
        basket.classList.remove('invincible');
    }, 3000);
}

function showPopup(text) {
    popupText.textContent = text;
    popupText.style.opacity = 1;
    popupText.style.transform = 'translate(-50%, -50%) scale(1)';
    
    setTimeout(() => {
        popupText.style.transition = 'all 0.5s ease-out';
        popupText.style.opacity = 0;
        popupText.style.transform = 'translate(-50%, -80%) scale(0.5)';
    }, 800);
    
    setTimeout(() => {
        popupText.style.transition = '';
    }, 1300);
}

/* Sparkles */
function createSparkle() {
    const sparkle = document.createElement("div");
    sparkle.classList.add("sparkle");
    sparkle.style.left = Math.random() * getGameWidth() + "px";
    sparkle.style.animationDuration = (3 + Math.random() * 3) + "s";
    document.body.appendChild(sparkle);
    setTimeout(() => sparkle.remove(), 6000);
}

/* Floating Love Text */
function createLoveText() {
    const text = document.createElement("div");
    text.classList.add("loveText");
    text.innerHTML = loveMessages[Math.floor(Math.random() * loveMessages.length)];
    text.style.left = Math.random() * (getGameWidth() - 200) + "px";
    document.body.appendChild(text);
    setTimeout(() => text.remove(), 6000);
}

</script>

</body>
</html>